<link rel="stylesheet" href="{{ url_for('static', path='auth/login.css') }}">
{% extends "base.html" %}

{% block content %}
<div class="form-container">
    <h2>Login</h2>
    <form action="/login" method="post">
        <input type="text" name="username" placeholder="Usuário" required>
        <input type="password" name="password" placeholder="Senha" required>
        <button type="submit">Entrar</button>
    </form>
    <div id="token-output"></div>
</div>
<script>
    document.getElementById('login-form').addEventListener('submit', async function (e) {
        e.preventDefault();

        const formDataRaw = new FormData(this);
        const formData = new URLSearchParams();
        formData.append("username", formDataRaw.get("username"));
        formData.append("password", formDataRaw.get("password"));

        const response = await fetch("/login", {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: formData
        });

        const output = document.getElementById('token-output');

        if (response.ok) {
            try {
                const result = await response.json();  // apenas se tiver JSON
                localStorage.setItem("token", result.access_token);
            } catch (err) {
                console.warn("Resposta não é JSON, ignorando");
            }
        } else {
            const result = await response.json();
            output.textContent = 'Erro: ' + (result.detail || 'Falha no login');
            output.style.color = 'red';
        }
    });
</script>
{% endblock %}